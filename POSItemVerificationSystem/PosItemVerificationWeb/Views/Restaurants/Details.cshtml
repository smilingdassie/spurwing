<!-- Views/Restaurants/Details.cshtml -->
@model PosItemVerificationWeb.Models.Restaurant

@{
    ViewData["Title"] = "Restaurant Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-store"></i> @Model.RestaurantName</h1>
    <div>
        <a asp-controller="Gantt" asp-action="Index" asp-route-restaurantKey="@Model.RestaurantKey" class="btn btn-primary">
            <i class="fas fa-chart-gantt"></i> View Gantt Chart
        </a>
        <a asp-action="Edit" asp-route-id="@Model.RestaurantKey" class="btn btn-outline-warning">
            <i class="fas fa-edit"></i> Edit
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Restaurant Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4">DC Link:</dt>
                            <dd class="col-sm-8"><code>@Model.DCLink</code></dd>

                            <dt class="col-sm-4">Brand:</dt>
                            <dd class="col-sm-8">
                                <span class="badge bg-info">@Model.BrandName</span>
                            </dd>

                            <dt class="col-sm-4">Address:</dt>
                            <dd class="col-sm-8">@Model.Address</dd>

                            <dt class="col-sm-4">City:</dt>
                            <dd class="col-sm-8">@Model.City, @Model.Province @Model.PostalCode</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Target Opening:</dt>
                            <dd class="col-sm-7">
                                @if (Model.TargetOpeningDate.HasValue)
                                {
                                    <span class="text-warning">
                                        <i class="fas fa-calendar-alt"></i>
                                        @Model.TargetOpeningDate.Value.ToString("MMMM dd, yyyy")
                                    </span>
                                }
                                else
                                {
                                    <span class="text-muted">Not set</span>
                                }
                            </dd>

                            <dt class="col-sm-5">Actual Opening:</dt>
                            <dd class="col-sm-7">
                                @if (Model.ActualOpeningDate.HasValue)
                                {
                                    <span class="text-success">
                                        <i class="fas fa-check-circle"></i>
                                        @Model.ActualOpeningDate.Value.ToString("MMMM dd, yyyy")
                                    </span>
                                }
                                else
                                {
                                    <span class="text-muted">Not opened yet</span>
                                }
                            </dd>

                            <dt class="col-sm-5">Status:</dt>
                            <dd class="col-sm-7">
                                @{
                                    var statusClass = Model.Status switch
                                    {
                                        "Planning" => "bg-secondary",
                                        "In Progress" => "bg-warning",
                                        "Completed" => "bg-success",
                                        "On Hold" => "bg-danger",
                                        _ => "bg-secondary"
                                    };
                                }
                                <span class="badge @statusClass">@Model.Status</span>
                            </dd>

                            <dt class="col-sm-5">Created:</dt>
                            <dd class="col-sm-7">@Model.CreatedDate.ToString("MMMM dd, yyyy")</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        @if (Model.OpeningProjects?.Any() == true)
        {
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="fas fa-project-diagram"></i> Opening Projects</h5>
                </div>
                <div class="card-body">
                    @foreach (var project in Model.OpeningProjects)
                    {
                        <div class="border rounded p-3 mb-3">
                            <h6>@project.ProjectName</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <small class="text-muted">
                                        Started: @project.ProjectStartDate.ToString("MMM dd, yyyy")
                                    </small>
                                </div>
                                <div class="col-md-6">
                                    <span class="badge bg-info">@project.ProjectStatus</span>
                                </div>
                            </div>

                            @if (project.TaskExecutions?.Any() == true)
                            {
                                <div class="mt-3">
                                    <small class="text-muted">
                                        Tasks: @project.TaskExecutions.Count(te => te.Status == "Completed") completed
                                        of @project.TaskExecutions.Count() total
                                    </small>
                                    <div class="progress mt-1">
                                        @{
                                            var completedTasks = project.TaskExecutions.Count(te => te.Status == "Completed");
                                            var totalTasks = project.TaskExecutions.Count();
                                            var progressPercent = totalTasks > 0 ? (completedTasks * 100 / totalTasks) : 0;
                                        }
                                        <div class="progress-bar" role="progressbar"
                                             style="width: @progressPercent%"
                                             aria-valuenow="@progressPercent"
                                             aria-valuemin="0"
                                             aria-valuemax="100">
                                            @progressPercent%
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-tasks"></i> Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a asp-controller="Gantt" asp-action="Index" asp-route-restaurantKey="@Model.RestaurantKey" class="btn btn-outline-primary">
                        <i class="fas fa-chart-gantt"></i> View Timeline
                    </a>
                    <a href="#" class="btn btn-outline-info">
                        <i class="fas fa-tasks"></i> Manage Tasks
                    </a>
                    <a href="#" class="btn btn-outline-warning">
                        <i class="fas fa-file-alt"></i> Generate Report
                    </a>
                    <a asp-action="Edit" asp-route-id="@Model.RestaurantKey" class="btn btn-outline-secondary">
                        <i class="fas fa-edit"></i> Edit Details
                    </a>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-clock"></i> Timeline</h6>
            </div>
            <div class="card-body">
                @if (Model.TargetOpeningDate.HasValue)
                {
                    var daysToOpening = (Model.TargetOpeningDate.Value - DateTime.Now).Days;
                    @if (daysToOpening > 0)
                    {
                        <div class="text-center">
                            <h4 class="text-warning">@daysToOpening</h4>
                            <small class="text-muted">days until target opening</small>
                        </div>
                    }
                    else if (daysToOpening < 0)
                    {
                        <div class="text-center">
                            <h4 class="text-danger">@Math.Abs(daysToOpening)</h4>
                            <small class="text-muted">days overdue</small>
                        </div>
                    }
                    else
                    {
                        <div class="text-center">
                            <h4 class="text-success">Today!</h4>
                            <small class="text-muted">Target opening date</small>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center text-muted">
                        <i class="fas fa-calendar-times fa-2x mb-2"></i>
                        <p>No target date set</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a asp-action="Index" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to List
    </a>
</div>